<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--

	zenlike1.0 by nodethirtythree design
	http://www.nodethirtythree.com

-->
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>pGina fork</title>
<meta name="keywords" content="" />
<meta name="description" content="" />

<link rel="stylesheet" type="text/css" href="http://mutonufoai.github.io/pgina/default_doc.css" />

</head>
<body>

<div id="outer">

	<div id="header">
		<div id="headercontent">
			<h1>pGina fork</h1>
			<h2>Open Source Windows Authentication</h2>
		</div>
		<div id="logo"><a href="http://mutonufoai.github.io/pgina/index.html"><img src="http://mutonufoai.github.io/pgina/images/pginalogo.png" /></a></div>
	</div>

	
	<div id="menu">
		<!-- HINT: Set the class of any menu link below to "active" to make it appear active -->
		<ul>
			<li><a href="http://mutonufoai.github.io/pgina/index.html">Home</a></li>
			<li><a href="http://mutonufoai.github.io/pgina/download.html">Download</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/support.html">Support</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/documentation.html" class="active">Documentation</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/develop.html">Develop</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/faq.html">FAQ</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/thanks.html">Thanks</a></li>
		</ul>
	</div>

	<div id="menubottom"></div>

	<div id="content">
	    
	    
		
			
<h1 id="pgina_users_guide">pGina User’s Guide</h1>

<ul>
<li><a href="#installation">Installation</a></li>

<li><a href="#how_pgina_works">How pGina Works</a></li>

<li><a href="#selecting_and_configuring_plugins">Selecting and Configuring Plugins</a></li>

<li><a href="#ordering_plugins">Ordering Plugins</a></li>

<li><a href="#testing_plugins">Testing Plugins</a></li>

<li><a href="#logging">Logging</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>pGina is packaged in a standard Windows installer, so installation is as easy as downloading and running the installer. After initial installation, pGina will be configured with the “LocalMachine” plugin enabled for the authentication and gateway stages (see below). This means that you will be able to use pGina out-of-the-box to log into the machine using existing local accounts, and if necessary, the LocalMachine plugin will create accounts for authenticated users.</p>

<p>In addition to the “LocalMachine” plugin, a standard set of additional plugins is provided and made available, but none of them are initally enabled.</p>

<h3 id="verify_install">Verify Install</h3>

<p>After installation, start the pGina configuration application. Verify that the pGina service is running and that the Credential Provider/GINA is installed and enabled.</p>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/components_green_screen.png" alt="pgina Components Enabled" /></p>

<p>pGina will not function properly unless these components are working. More information about the Credential Provider and pGina service is provied in the next section.</p>

<h2 id="how_pgina_works">How pGina Works</h2>

<p>pGina is a replacement for the default Windows Credential Provider (or CP). Through plugins, pGina allows you to configure many aspects of the login process from authentication and authorization through to logging and terminal events.</p>

<p><em>Note that the Credential Provider framework is supported in Windows 7/Vista and higher. Prior versions of Windows used a framework called GINA. For much of this guide, we’ll simply refer to it as a Credential Provider or CP.</em></p>

<p>The diagram below represents a high-level picture of a typical logon process.</p>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/pGina-logon-overview.png" alt="pGina logon diagram" /></p>

<p>The logon process proceeds as follows:</p>

<ol>
<li>The user enters their credentials at the pGina logon user interface. Note that this UI may be one of several options (called credential providers) presented to the user. For example, the user might be presented with several tiles, many of which are local accounts with only one being the pGina UI.</li>

<li>The pGina credential provider (or GINA) passes the unaltered credentials to the pGina service. The service then sends those credentials through the <a href="#plugins">plugin pipeline</a> described below.</li>

<li>After the credentials have been <a href="#plugins">processed by the plugins</a>, the pGina service sends a result (success/failure) along with a set of credentials (username/ password) back to the pGina CP. Note that these credentials may not be the same as those that were provided by the user. They may have been altered at some stage by one or more plugins.</li>

<li>If the result returned from step three is success, the pGina credential provider passes the (possibly altered) credentials to Windows indicating a successful logon attempt. Note that pGina does not actually log the user on to the machine. It is the Windows OS itself that does that. This means that if a local account does not exist that matches the credentials, the logon will fail, even if the pGina plugins have registered success. Therefore, it is often the case that one of the plugins will be responsible for creating a local (often temporary) account. The plugin called “Local Machine” takes care of this in the Gateway stage. For details, see the <a href="http://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">documentation for the Local Machine plugin</a>.</li>
</ol>

<p>As indicated above, it is important to note that pGina does not actually log the user on to the computer. The Windows OS is still ultimately responsible for logging the user on to the machine and possibly creating a profile for the user. pGina’s job is to authenticate and authorize the user, and perform any other pre-logon actions that may be needed. This means that in order for a logon to be successful, a local account must exist that matches the credentails returned by the pGina CP (Credential Provider). In a typical case, pGina would be configured to create the local account prior to logon, and possibly delete that account after logoff (see the <a href="http://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">LocalMachine plugin</a>).</p>

<h3 id="the_pgina_architecture">The pGina Architecture</h3>

<p>pGina consists of two main components: the Credential Provider (or GINA), and the pGina service (which manages the plugins).</p>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/pgina_components.png" alt="pGina components" /></p>

<p>The CP augments or replaces the default Windows authentication user interface. It plugs-in to the Windows system and can configure the UI that is displayed at login time (or during unlock, UAC control, etc.). The pGina CP, however, does very little on its own. It simply receives the user’s credentials and passes them along to the pGina service via a named pipe, and then waits for a response from the service. User authentication/authorization is instead managed by the plugins that run within the pGina service.</p>

<p>The pGina service is a standard Windows service that is started at boot time, and runs with administrator priviledges. Note that upon initial boot, it may take some time for pGina service to start, and the CP will (of course) be unable to communicate with the service until it is started.</p>

<h3 id="plugins">Plugins</h3>

<p>pGina manages the logon process by delegating the work to a set of zero or more plugins. Plugins have the job of deciding whether or not the user is who she says she is (authentication), whether the user should be granted access (authorization), and taking other login-time actions. The process involves a pipeline consisting of three main stages as illustrated in the following diagram.</p>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/pgina_stages.png" alt="pGina stages" /></p>

<p>Each stage involves zero or more plugins, and a given plugin may be involved in multiple stages. After the user provides his/her credentials, pGina passes through the three stages one at a time, in the order shown above. Each stage may succeed or fail depending on the results of the plugins involved. The purpose of each stage is summarized below.</p>

<ul>
<li><strong>Authentication</strong> - Plugins involved in this stage validate that the user is who he/she says she is. This might be done by validating the credentials against some external database or other source.</li>

<li><strong>Authorization</strong> - This stage is intended to determine whether or not the user (who is already authenticated) is allowed to access the resources that are being requested. For example, a user might only be allowed to login if they are a member of certain groups.</li>

<li><strong>Gateway</strong> - This is similar to the Authorization stage in that it may fail, however, the intention is not to authorize users, but to provide post-authorization account management that may fail. For example, the “Local Machine” plugin executes within the gateway stage. It is responsible for creating (if necessary) a local Windows account that matches the credentials of the user that is logging in. If for some reason, this fails, then the user cannot be logged in, and this plugin must stop the login process and provide an appropriate error message. In general, this stage provides a “last chance” for a login to fail (post authenticate/authorize).</li>
</ul>

<p>Plugins can be configured to provide services for zero or more of the above stages. For example, the “LocalMachine” plugin provides services for all three stages. In the authentication stage, it verifies that the user’s credentials match that of some existing local account, and in the authorization state, it verifies that the authenticated user is allowed to log on to the machine.</p>

<p>There can be zero or more plugins involved with each stage. If any stage fails, the login fails. However, stages have different rules regarding when a stage succeeds or fails.</p>

<ul>
<li><strong>Authentication</strong> - At least one of the plugins involved in this stage must register success for the process to continue. If there are zero plugins registered, this stage fails.</li>

<li><strong>Authorization</strong> - All plugins involved in this stage must register success for the process to continue. If there are no plugins registered, this stage succeeds.</li>

<li><strong>Gateway</strong> - All plugins involved in this stage must register success for the process to continue. If there are no plugins registered, this stage succeeds. However, the “Local Machine” plugin will almost always be registered in this stage.</li>
</ul>

<p>Plugins can provide services to multiple stages, and these services can be selectively turned on or off. For example, consider plugin Foo that provides Authentication and Authorization. pGina can be confiured such that Foo only provides Authentication, only Authorization, both, or neither. Configuration is described later in this document.</p>

<p>Plugins can also be ordered within each stage. For example, suppose plugins Foo and Bar are providing services to the user session stage. We can configure Foo to be invoked before Bar, or Bar before Foo.</p>

<h4 id="user_information">User Information</h4>

<p>During the execution of the above pipeline, pGina maintains some information about the user. This includes user-name, password, group membership and other information. This information can be altered by plugins during the pipeline, and/or used by plugins to modify the state of the machine. For example, plugins may add or remove groups, alter the username or password, or a plugin might attempt to create a local account using this information. This means that the order that the plugins execute within each stage of the pipeline is important (see below), and different orders may produce different results. One must be careful to configure your plugins in the order that makes sense for your setup. The final values of username/password/domain are passed along to Windows to complete the logon process.</p>

<p>In a typical setup one wants to make sure that a local account exists or is created at the end of the pipeline. To do so, one should configure the LocalMachine plugin so that it executes last in the Gateway stage. It is the Gateway stage of the <a href="http://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">LocalMachine</a> plugin that creates (if necessary) local accounts. If the <a href="http://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">LocalMachine</a> plugin executes earlier, it may miss important information for the local account (such as group membership).</p>

<h3 id="event_notifications">Event Notifications</h3>

<p>Plugins may also register to recieve event notifications from Windows Terminal Services. These events include: logon, logoff, lock, unlock, console connect, console disconnect, and a few others (see <a href="http://msdn.microsoft.com/en-us/library/system.serviceprocess.sessionchangereason.aspx">msdn</a> for a full list). A plugin that desires to recieve these notifications will be listed as a “Notification” plugin in the configuration interface. The plugin will not recieve events unless it is enabled (see the section on configuration below).</p>

<h3 id="change_password">Change Password</h3>

<p>Plugins can register to recieve change password notifications from the Credential Provider, by using CTRL+ALT+DEL or CTRL+ALT+END. Pgina will not recieve a change password event from the control panel or managment console! A plugin that desires to recieve these notifications will be listed as a “Change Password” plugin in the configuration interface. The plugin will not recieve events unless it is enabled (see the section on configuration below).</p>

<h2 id="selecting_and_configuring_plugins">Selecting and Configuring Plugins</h2>

<p>In the pGina configuration interface, plugins can be enabled/disabled under the “Plugin Selection” tab. If a plugin provides services for a given stage, a checkbox will appear in the appropriate column. You can enable/disable a plugin for a given stage by using the checkbox.</p>

<p>To configure a plugin, double click on it or select it and click on “Configure..”. The plugin’s configuration dialog will appear. The options are plugin specific, and you should refer to the documentation for each plugin for details about configuration of an individual plugin.</p>

<h2 id="ordering_plugins">Ordering Plugins</h2>

<p>Under the “Plugin Order” tab, you can determine the order that each plugin is invoked. There is a list for each pGina stage, and you can re-order the plugins within each list.</p>

<h2 id="testing_plugins">Testing Plugins</h2>

<p>To verify that your plugins are configured and working properly, pGina provides a login simulator that can be found under the “Simulation” tab in the pGina configuration interface. With the simulator, you can initiate a simulated login, and verify success or failure of each pGina plugin and pipeline stage.<br />The simulator also provides a “live” view of the pGina log file via the “View Log” button. If something fails to work as expected, you should be able to find information within the log view regarding what occured.</p>

<p>Under “Final User Data,” the simulator shows the final set of credentials that are provided to Windows. These credentials must match a local account (possibly created by a plugin) for the logon to be successful.</p>

<p>Under “Local Groups,” the simulator shows the pGina list of local groups after the pipeline is complete. Note that this list may not be the list that is actually granted to the local account unless the local machine plugin executes <strong>last</strong> in the Gateway stage.</p>

<h2 id="logging">Logging</h2>

<p>pGina logs information to the following files, found in the main pGina installation directory (<code>%ProgramFiles%\pGina\log</code>).</p>

<ul>
<li>
<p><code>pGina.Configuration_log.txt</code></p>

<p>This contains log messages from the pGina configuration application.</p>
</li>

<li>
<p><code>pGina.Service.ServiceHost_log.txt</code></p>

<p>This file contains log messages from the pGina service.</p>
</li>

<li>
<p><code>pGina.InstallUtil_log.txt</code></p>

<p>This contains log messages from the registration utility that is used during installation/uninstallation to enable/disable the CP and pGina service.</p>
</li>
</ul>

<p>Logging support in pGina is supported by <a href="http://logging.apache.org/log4net/">Apache log4net</a>, and is configured within the log4net configuration file, which is (by default) located here:</p>

<p><code>%ProgramFiles%\pGina\log4net.config</code>.</p>

<p>If you would like to log to a different file, simply edit this file. For details about log4net configuration, see the <a href="http://logging.apache.org/log4net/release/manual/introduction.html">Apache log4net documentation</a>.</p>

    
		
		<!-- Secondary content: Stuff that goes in the secondary content column (by default, the narrower right column) -->



	</div>

	<div id="footer">
			<div class="left">&copy; 2014 pgina.org</div>
			<div class="right">Original design by 
			<a href="http://www.nodethirtythree.com/">NodeThirtyThree Design</a></div>
	</div>
	
</div>

</body>
</html>

